<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>fuel_php</title>
  <meta name="description" content="fuel_php">
  <meta name="author" content="">

  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="http://karadaharu.github.io/css/fonts.css">
  
  
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
  

    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">

  <link rel="stylesheet" href="http://karadaharu.github.io/css/custom.css">

  
  
  <link rel="stylesheet" href="http://karadaharu.github.io/highlight/styles/default.css">
  
  <script src="http://karadaharu.github.io/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>


<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="/" class="site-title pure-menu-heading">Kazumasa KANEKO</a>
            <ul class="pure-menu-list">
                
                <li class="pure-menu-item">
                    <a href="http://karadaharu.github.io/about/" class="pure-menu-link">About</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.github.io/publications/" class="pure-menu-link">Publications</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.github.io/works/" class="pure-menu-link">Works</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.github.io/memo/" class="pure-menu-link">Memo</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">Kazumasa KANEKO</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
                
                <li class="pure-menu-item">
                    <a href="http://karadaharu.github.io/about" class="pure-menu-link">About</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.github.io/publications" class="pure-menu-link">Publications</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.github.io/works" class="pure-menu-link">Works</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.github.io/memo" class="pure-menu-link">Memo</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
	<div class="pure-u-11-12 pure-u-md-5-8">
        <div class="post">

            <div class="post-title">
                <p class="footnote">
		            
                    
                    

                    

                    
                </p>
                <h1>fuel_php</h1>
            </div>

            <div class="post-content">
                

<h1 id="fuel-php:04a8d742a11f174dda048d75dde11792">FUEL PHP</h1>

<h2 id="config:04a8d742a11f174dda048d75dde11792">config</h2>

<p>設定</p>

<h3 id="routes-php:04a8d742a11f174dda048d75dde11792">routes.php</h3>

<pre><code>'themes'   =&gt; array('theme/index',  'name' =&gt; 'theme_index'),
$api_root . '/1/themes'   =&gt; array('api/theme/index',     'name' =&gt; 'api_theme_index'),
</code></pre>

<p>/themes/にアクセスすると、
thme/index:theme.phpのaction_index()関数が呼ばれる。
&lsquo;name&rsquo;は何かのID的なかんじ？</p>

<p>/api/theme/index:apiディレクトリのtheme.phpのactiion_index関数が呼ばれる.
action_indexとは限らなくて、get_indexもある。
actionとgetの違いは？
fuelphpではコントローラのアクションメソッドget_hoge, post_hogeでGET,POST時に呼び出すメソッドを分けることができる。actionはどちらでもいい。
postがないときにPOSTできたらどうなるのか？</p>

<h2 id="migrations:04a8d742a11f174dda048d75dde11792">migrations</h2>

<p>データベースのマイグレーション
<a href="http://press.nekoget.com/fuelphp_doc/general/migrations.html">http://press.nekoget.com/fuelphp_doc/general/migrations.html</a>
データベースの変更を手動で他の人にやらせないようにする。
マイグレーションファイルは先頭にシリアルナンバーがある
upで設定して次に進む、downでその削除してひとつ前に戻る、</p>

<pre><code>php oil refine migrate:up -default
</code></pre>

<p>FUEL_ENV=production php oil refine migrate
で指定できる</p>

<p>FUEL_ENV=development php oil refine migrate:up -default</p>

<h2 id="vendor:04a8d742a11f174dda048d75dde11792">vendor</h2>

<p>fbログインなどのfuelphpと関係ないもの</p>

<h2 id="lang:04a8d742a11f174dda048d75dde11792">lang</h2>

<h2 id="themes:04a8d742a11f174dda048d75dde11792">themes</h2>

<h2 id="views:04a8d742a11f174dda048d75dde11792">views</h2>

<p>テンプレートファイル</p>

<h2 id="classes:04a8d742a11f174dda048d75dde11792">classes</h2>

<h3 id="input:04a8d742a11f174dda048d75dde11792">Input:</h3>

<p>HTTPパラメータや、サーバ変数、ユーザーエージェント情報へのアクセス</p>

<p>JSON APIのURLをIEでたたくとXSS攻撃ができてしまう場合がある。
対策：XHRを利用するときはX-Requested-Withヘッダを設定し、設定していなければサーバー側でエラーにする
XHR:XML Http Request。javascriptオブジェクト。XMLに限らないデータ形式でURLからデータを読み出す簡単な方法を提供。</p>

<p>entries e</p>

<h3 id="langクラス-言語の変数をセットすることができる:04a8d742a11f174dda048d75dde11792">Langクラス:言語の変数をセットすることができる</h3>

<p>同じページで使われている文章、単語などをセットしておくのに使っている
例
title:記事管理
これをすることで、ほぼ同じレイアウトの画面で、同じパーツについての文章の管理を分けることができる。
テンプレートはapp/lang/ja/下</p>

<h3 id="configクラス:04a8d742a11f174dda048d75dde11792">configクラス</h3>

<p>/config/auth/roles.ymlでユーザーロールの定数を書いておいてある。</p>

<h2 id="controller:04a8d742a11f174dda048d75dde11792">controller</h2>

<p>DB操作は/packages_additions/の中のファイルで行っている。
そこで返すのは/app/classes/view_class/内のクラスのインスタンス。
view_classで整形を行う。たとえばAPIで見られる変数と見られない変数を分けるためのメソッドなどがある。基本的な整形操作はView_Class_Baseで書いて、それぞれの変数をそれぞれのクラスで行うイメージ。</p>

<p>データベースの接続先などが書いてあるのは？？</p>

<h3 id="apiの作り方:04a8d742a11f174dda048d75dde11792">APIの作り方</h3>

<p>Controller_Restを継承して作る。</p>

<pre><code>protected $format = 'json';　# ただの変数の宣言に見えて、親クラスで意味のある変数に値を入れていることがある
</code></pre>

<h3 id="ormオブジェクトリレーショナルマッパー:04a8d742a11f174dda048d75dde11792">ORMオブジェクトリレーショナルマッパー</h3>

<h2 id="pagination:04a8d742a11f174dda048d75dde11792">pagination</h2>

<p>forge メソッドは、新しい pagination インスタンスを作成し、配列を渡すことで設定ができます。
forge:鉄を鍛える</p>

<p>query builder
DB::select()</p>

<p>ORM
Model_Post::query()</p>

<p>DB::query()
違い？？</p>

<p>そもそも、$query-&gt;param(&lsquo;role&rsquo;,100)-&gt;execute()-&gt;as_array();
って？？</p>

<p>selectメソッドのときのfromはテーブルの名前なので、いらない
$query-&gt;from(&lsquo;pagination&rsquo;);</p>

<pre><code>          &lt;span tal:content=&quot;admins/pagination/render()&quot;&gt;&lt;/span&gt;
</code></pre>

<p>&lsquo;uri_segment&rsquo; =&gt; 3,
はなぜ3じゃないと動かないの？？</p>

<h3 id="問題:04a8d742a11f174dda048d75dde11792">問題</h3>

<ul>
<li>phptalを使った書き方ができていない</li>
<li>next()を呼んでも、URLは生成されるけど、中身が生成されず、404になる

<ul>
<li>routeに1,2,って書けばちゃんと表示されるけど、これはだるすぎる。
たぶん、ひとつの階層に対して、ひとつのパラメーターをとれる。→別の階層を作ってやらないといけない？→queryによるペジネーションにすることで解決</li>
</ul></li>
<li>pagination_urlを設定しても思ったとおりのパスにならず、admin/user/下に生成される→なぜかなおった。解決</li>
</ul>

<h3 id="dbの操作:04a8d742a11f174dda048d75dde11792">dbの操作</h3>

<p>SQL文を書けるメソッド
DB::query(&lsquo;sql sentence&rsquo;)
セレクト用のメソッド
DB::select(&lsquo;id&rsquo;,&lsquo;name&rsquo;)</p>

<p>オリジナルのクラスの場所
packages_additions</p>

<h3 id="ログイン機能:04a8d742a11f174dda048d75dde11792">ログイン機能</h3>

<p>Authパッケージ
認証システム
Simpleauthまたは、Ormauthから選べる。
Ormauthはデータをデータベースに保存する
データはORMモデルを通じてアクセス</p>

<p>ACL(Access Control List)ユーザに応じて各種機能のアクセス権を設定するコンポーネント
ACLは３つのテーブルからなる。ユーザー（ARO）、対象ページ（ACO）、その関係（ARO_ACO）</p>

<p>composer:外部ライブラリの管理に使う。</p>

<h2 id="php:04a8d742a11f174dda048d75dde11792">PHP</h2>

<h3 id="メソッドチェイン:04a8d742a11f174dda048d75dde11792">メソッドチェイン</h3>

<p>return $this;
とすることで、　
変数をセットするだけのメソッドなどを
$ins-&gt;setThis()-&gt;setThis2();
とつなげて可読性の高いコードが書ける。</p>

<h3 id="クラス:04a8d742a11f174dda048d75dde11792">クラス</h3>

<p>Non-static method Auth_Login_Maholobaauth::validate_user() should not be called statically, assuming $this from incompatible context</p>

<p>クラスとメソッドの呼び出し方をひと通り</p>

<p>クラスからオブジェクトの作成、オブジェクトからメンバ変数、メンバメソッドの呼び出し</p>

<pre><code>$var = new Foo();
$ice = $var-&gt;nila();
$spoon = $var-&gt;bon;
</code></pre>

<p>メンバ変数・メソッドのアクセス制御
private:そのクラスからしかアクセスできない
protected:そのクラスとサブクラスからしかアクセスできない
public:どこからでもアクセスできる</p>

<p>名前空間
バックスラッシュで区切ったメソッド等の名前がかぶらないようにするためのもの</p>

<p>動的呼び出しと静的呼び出し
静的呼び出しは::スコープ定義演算子という
動的呼び出し
$var = new Foo();
$var-&gt;gu();</p>

<p>静的呼び出し
Foo::shi();</p>

<h4 id="名前空間:04a8d742a11f174dda048d75dde11792">名前空間</h4>

<p>\barbarian\Conan()
バックスラッシュで名前空間を分けることで、同じ名前のクラスを作れるみたいな感じ。
ディレクトリと似ている概念
<a href="http://www.slideshare.net/KosukeHorii/5-9037647">http://www.slideshare.net/KosukeHorii/5-9037647</a></p>

            </div>
        </div>
	</div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>

<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="pure-menu pure-menu-horizontal footer-content">
            <ul>
                <li class="pure-menu-heading" id="foot-name">:</li>

                

                

                

                

                

            </ul>
            <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
        </div>
	  </div>
      <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<script src="http://karadaharu.github.io/js/jquery.min.js" type="text/javascript"></script>
<script src="http://karadaharu.github.io/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>

</body>
</html>

