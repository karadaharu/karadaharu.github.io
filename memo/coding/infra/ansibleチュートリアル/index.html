<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>ansibleチュートリアル</title>
  <meta name="description" content="ansibleチュートリアル">
  <meta name="author" content="">

  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="http://karadaharu.org/css/fonts.css">
  
  
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
  

    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">

  <link rel="stylesheet" href="http://karadaharu.org/css/custom.css">

  
  
  <link rel="stylesheet" href="http://karadaharu.org/highlight/styles/default.css">
  
  <script src="http://karadaharu.org/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>


<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="/" class="site-title pure-menu-heading">Kazumasa Kaneko</a>
            <ul class="pure-menu-list">
                
                <li class="pure-menu-item">
                    <a href="http://karadaharu.org/about/" class="pure-menu-link">About</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.org/works/" class="pure-menu-link">Works</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.org/memo/" class="pure-menu-link">Memo</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.org/contact/" class="pure-menu-link">Contact</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">Kazumasa Kaneko</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
                
                <li class="pure-menu-item">
                    <a href="http://karadaharu.org/about" class="pure-menu-link">About</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.org/works" class="pure-menu-link">Works</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.org/memo" class="pure-menu-link">Memo</a>
                </li>
                <li class="pure-menu-item">
                    <a href="http://karadaharu.org/contact" class="pure-menu-link">Contact</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
	<div class="pure-u-11-12 pure-u-md-5-8">
        <div class="post">

            <div class="post-title">
                <p class="footnote">
		            
                    
                    

                    

                    
                </p>
                <h1>ansibleチュートリアル</h1>
            </div>

            <div class="post-content">
                

<h1 id="ansibleチュートリアル:ee61cdd6ac0e63e4af476b1e6e5d1ba9">ansibleチュートリアル</h1>

<p>基本的にはこれを参考に。
<a href="http://yteraoka.github.io/ansible-tutorial/">http://yteraoka.github.io/ansible-tutorial/</a></p>

<pre><code>sudo yum install patch, git
sudo yum groupinstall &quot;Development tools&quot;
yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-deve
</code></pre>

<pre><code>sudo -s
curl -O https://www.python.org/ftp/python/2.7.6/Python-2.7.6.tgz
tar zxf Python-2.7.6.tgz
cd Python-2.7.6
./configure --prefix=/opt/local
make &amp;&amp; make altinstall
vi ~/.bashrc
PATH=/opt/local/bin/:$PATH
source ~/.bashrc
</code></pre>

<p>pip,ansibleのインストール</p>

<pre><code>curl -kL https://raw.github.com/pypa/pip/master/contrib/get-pip.py | python2.7
sudo /opt/local/bin/pip2.7 install ansible
</code></pre>

<h2 id="yml:ee61cdd6ac0e63e4af476b1e6e5d1ba9">yml</h2>

<p>XMLのような構造化されたデータを表現するためのフォーマット
それを処理するためのライブラリが必要。</p>

<p>配列
- aaa
- bbb
- ccc</p>

<h2 id="yamlドキュメントの単位:ee61cdd6ac0e63e4af476b1e6e5d1ba9">YAMLドキュメントの単位</h2>

<ul>
<li>a</li>
<li>b
&mdash;</li>
<li>a</li>
<li>x</li>
</ul>

<p>タブ文字はだめ</p>

<p>msg: cannot find ‘service’ binary or init script for service, possible typo in service name?, aborting
→チェック時はインストールされていないものについてrunningチェックはできない？</p>

<p>とりあえずこれで
cent os →cent osはクリア</p>

<h2 id="cent-os-freebsd:ee61cdd6ac0e63e4af476b1e6e5d1ba9">cent os → freebsd</h2>

<p>Ansibleは接続先OSの/user/bin/にpythonを探しに行くが、
freebsdは/user/local/bin/にpythonをインストールするのでエラーになる
もしかしたらデフォルトではpython入ってないのかも？
入ってない場合は。</p>

<pre><code>pkg_add -v -r python27
</code></pre>

<pre><code>ln -s /user/local/bin/python2.7 /user/bin/python
</code></pre>

<h3 id="プレイブックを書く:ee61cdd6ac0e63e4af476b1e6e5d1ba9">プレイブックを書く</h3>

<p>インタラクティブな動作の場合（y/n）</p>

<p>pkgng: name=gmake,freetype2,jpeg,png,t1lib,limbcrypt,tidy-lib,nginx state=present</p>

<p>pkg install gmakeで見に行くのが、
<a href="http://pkg.FreeBSD.org/freebsd:9:x86:64/latest/All/gmake-4.1.txz">http://pkg.FreeBSD.org/freebsd:9:x86:64/latest/All/gmake-4.1.txz</a>
だけど実際は
gmake-4.1_1.txz</p>

<p>BSD系はBSD版makeが標準となっているので、gnu makeを使うときは別でインストールしないといけない。
gnu makeからソースコードをダウンロード、ふつうにインストールしたら/usr/local/binにmakeがインストールされたので、
それを/usr/binにgmakeとしてシンボリックリンク作成</p>

<p>エラーをはいたときにとりあえず次に行く
ignore_errors: yes</p>

<p>一度やったことは二度目はパスしてほしい。デフォルトでなるはずなんだけど。</p>

<p>どのユーザーでwhoコマンドをうってもvagrantのままなので注意。シェルをbashとかにすると、現在のログインユーザーが分かる。</p>

<p>pogtgresを操作するには、psycopg2が必要で、それをインストールするにはpip
curl -kL <a href="https://raw.github.com/pypa/pip/master/contrib/get-pip.py">https://raw.github.com/pypa/pip/master/contrib/get-pip.py</a> | python</p>

<p>pip install psycopg2
not found Python.h</p>

<blockquote>
<p>The python-dev package is required for compilation of Python extensions written in C or C++, like psycopg2 <a href="http://stackoverflow.com/questions/22938679/error-trying-to-install-postgress-for-python-psycopg2">Error trying to install Postgress for python (psycopg2)</a>stgress-for-python-psycopg2</p>

<p>ただ、C関数を作るので、Python.hなどのdevライブラリやgccといったツールを事前に
インストールしておく必要があります。<a href="http://tdoc.info/blog/2012/12/05/psycopg2.html">PostgreSQLをPythonからpsycopg2を使っていじる</a></p>
</blockquote>

<h2 id="python-install-on-freebsd:ee61cdd6ac0e63e4af476b1e6e5d1ba9">Python install on FreeBSD</h2>

<h3 id="via-port:ee61cdd6ac0e63e4af476b1e6e5d1ba9">via port</h3>

<h3 id="via-package-system:ee61cdd6ac0e63e4af476b1e6e5d1ba9">via package system</h3>

<h3 id="python-version-management:ee61cdd6ac0e63e4af476b1e6e5d1ba9">python version management</h3>

<p>There must be
/usr/local/bin/python
and defalut version is defined in /etx/make.conf
but there aren&rsquo;t
古い情報かも。</p>

<p>pip,setuptoolsなどではなく、portsを使ったほうが良い?</p>

<p>そもそもFreeBSDのほうに自分ではpythonインストールしていなかった。
もともとしてあるの？？もともとしてあるのは何かと不具合が多そう
新しくつくったfreebsdには、python2.7.5がもともと入っていた
いまのはpython2.7.8
自分で入れたっけ？
比較</p>

<h4 id="まっさら:ee61cdd6ac0e63e4af476b1e6e5d1ba9">まっさら</h4>

<p>ver 2.7.5
which python /usr/local/bin/python
python -&gt; python2 -&gt; python2.7</p>

<h4 id="現状:ee61cdd6ac0e63e4af476b1e6e5d1ba9">現状</h4>

<p>ver 2.7.8
which python /usr/bin/python-&gt;/usr/local/bin/python2.7</p>

<p>Ubuntu, Debianだとpython-devをインストールすればいいらしい</p>

<h2 id="freeebsdのパッケージ管理:ee61cdd6ac0e63e4af476b1e6e5d1ba9">FreeeBSDのパッケージ管理</h2>

<p><a href="https://www.freebsd.org/doc/ja_JP.eucJP/books/handbook/ports.html">https://www.freebsd.org/doc/ja_JP.eucJP/books/handbook/ports.html</a></p>

<p>ソフトウェアのインストール方法
* コンパイル済みのパッケージ→pkg_*からpkgngになった
* ソースからコンパイルするports:こっちのほうがfreeBSDでは人気らしい。オプションとかが色々設定できる</p>

<p>Pythonマニュアルにかかれているこれはだめ
pkg_add -r python
<a href="http://docs.python.jp/2/using/unix.html">http://docs.python.jp/2/using/unix.html</a></p>

<p>pkgng:新しい管理ツール
pkgngにしたら、pkg_* は使うべきではない
portmasterなどを置き換えるものではない。</p>

<h3 id="portsの使い方:ee61cdd6ac0e63e4af476b1e6e5d1ba9">portsの使い方</h3>

<p><a href="https://www.freebsd.org/doc/ja_JP.eucJP/books/handbook/ports-using.html">https://www.freebsd.org/doc/ja_JP.eucJP/books/handbook/ports-using.html</a></p>

<p>Ports Collectionの利用
Ports Collection とは、/usr/ports 以下に置かれる Makefile, 修正パッチ、 説明文などの一連のファイルのことです。</p>

<h4 id="初期設定:ee61cdd6ac0e63e4af476b1e6e5d1ba9">初期設定</h4>

<pre><code># portsnap fetch
# portsnap extract
# portsnap fetch
# portsnap update
</code></pre>

<p>勝手にportsツリーが変わっちゃうと困るときはsubversionで管理する</p>

<h4 id="インストール:ee61cdd6ac0e63e4af476b1e6e5d1ba9">インストール</h4>

<p><em>毎回確認すること</em>
* ports collection をアップデートする
* インストールするソフトウエアのセキュリティ上の問題を<a href="http://vuxml.freebsd.org/　で確認する">http://vuxml.freebsd.org/　で確認する</a></p>

<pre><code># cd ./database/py-psycopg2
# make install
</code></pre>

<p>でも同様にPython.hがないと言われる</p>

<p><a href="https://forums.freebsd.org/threads/python-header-files-not-found.37087/">https://forums.freebsd.org/threads/python-header-files-not-found.37087/</a>
ports/lang/python27をPTH OFFオプションで再インストールしろ
具体的なオプションの指定方法が分からない&hellip;MakefileにPTHとかのオプションないし。de</p>

<pre><code># cd /usr/ports/devel/libical
# make -DWITHOUT_PYTHON install clean
</code></pre>

<p>libical:iCalendarのオープンソース実装（？）</p>

<pre><code># cd /usr/ports/database/py-psycopg2
# make install
</code></pre>

<p>なぜかうまく行った！！
libicalのインストールに依存している何かのパッケージがインストールされたことで解消されたはず。
libicalをアンインストールしても、依存パッケージはアンインストールされない？
ちょっとまた大変なので、とりあえず次に。</p>

<p>そもそもpipとかeasy_installとかって何なのか
<a href="http://www.yunabe.jp/docs/python_package_management.html">http://www.yunabe.jp/docs/python_package_management.html</a>
ython には site-packages というディレクトリが存在し、そのサイト (マシン環境) 固有のモジュールは site-packages に保存されるようになっている。</p>

<p>posgresを起動したい。どうやったらできる？</p>

<pre><code>pg_ctl start -D /usr/local/pgsql/data/
</code></pre>

<p>とりあえずこれでできるけど、サービスに追加するには？このコマンドをansibleでやるには？</p>

            </div>
        </div>
	</div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>

<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="pure-menu pure-menu-horizontal footer-content">
            <ul>
                <li class="pure-menu-heading" id="foot-name">:</li>

                

                

                

                

                

            </ul>
            <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
        </div>
	  </div>
      <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<script src="http://karadaharu.org/js/jquery.min.js" type="text/javascript"></script>
<script src="http://karadaharu.org/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>

</body>
</html>

